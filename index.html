<!DOCTYPE html>
<html>
<head>
  <title>Position Training</title>
  <style>
    body {
      font-size: 24px; /* Adjust the base font size for overall text */
    }

    label {
      font-size: 1.2em; /* Slightly larger label text */
    }

    select {
      font-size: 1.2em;
    }

    input[type="number"] {
      font-size: 1.2em;
    }

    button {
      font-size: 1.5em; /* Make the button text larger */
      padding: 10px 20px; /* Add some padding around the text for a larger button appearance */
    }

    #currentPositionName {
      font-size: 1.8em; /* Make the position name larger */
      margin-top: 20px; /* Add some space above it */
    }

    #currentPositionImage {
      max-width: 80%; /* Adjust as needed to control image size */
      height: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div>
    <label for="difficulty">Difficulty:</label>
    <select id="difficulty">
      <option value="1">Easy</option>
      <option value="2">Medium</option>
      <option value="3">Hard</option>
    </select>
  </div>
  <div>
    <label for="duration">Duration (seconds):</label>
    <input type="number" id="duration" value="25">
  </div>
  <button onclick="startTraining()">Start</button>
  <div id="currentPositionName">Ready to Start</div>
  <img id="currentPositionImage" src="images/placeholder.png" alt="Current Position">

  <div id="timer"></div>    //Timer countdown
  <button id="stopButton" onclick="stopTraining()">Stop</button>   //Stop button 
  
  <script>
    const positions = [
       {
    name: "Nadu",
    audioFile: "audio/Nadu.mp3",
    imageFile: "images/female-nadu.jpg",
    difficulty: 1
  },
  {
    name: "Collar",
    audioFile: "audio/Collar.mp3",
    imageFile: "images/female-collar.png",
    difficulty: 1
  },
  {
    name: "Bara",
    audioFile: "audio/Bara.mp3",
    imageFile: "images/female-bara.jpg",
    difficulty: 1
  },
  {
    name: "Expose",
    audioFile: "audio/Expose.mp3",
    imageFile: "images/female-expose.jfif",
    difficulty: 1
  },
  {
    name: "Inspection",
    audioFile: "audio/Inspection.mp3",
    imageFile: "images/female-inspect.jpg",
    difficulty: 1
  },
  {
    name: "Sula",
    audioFile: "audio/female-sula.mp3",
    imageFile: "images/female-sula.png",
    difficulty: 1
  },
     {
    name: "Wait",
    audioFile: "audio/Waiting.mp3",
    imageFile: "images/female-wait.png",
    difficulty: 1
  }, 
  ];

    function playAudio(url) {
        // Inside this function, the 'url' parameter will hold the value
        // that was passed from the startTraining function (i.e., currentPosition.audioFile).
     console.log("Attempting to fetch audio from:", url); //
      fetch(url)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
        .then(audioBuffer => {
          const source = audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.connect(audioContext.destination);
          source.start();
        })
        .catch(error => console.error("Error playing audio:", error));
    }

    // Initialize the AudioContext (do this once)
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let trainingActive = false; // Flag to track if training is active
    let timerInterval; // To hold the interval for the countdown
    let endTime; // To store the end time of the training
    let timer; // To hold the timeout ID for nextPosition

   function updateTimerDisplay() {
      const now = Date.now();
      const timeLeft = Math.max(0, endTime - now); // Ensure time left is not negative
      const minutes = Math.floor((timeLeft / (1000 * 60)) % 60);
      const seconds = Math.floor((timeLeft / 1000) % 60);
      document.getElementById("timer").textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      if (timeLeft <= 0 && trainingActive) {
        trainingActive = false;
        clearTimeout(timer);
        clearInterval(timerInterval);
        alert("Training session complete!");
        document.getElementById("currentPositionName").textContent = "";
        document.getElementById("currentPositionImage").src = "";
      }
    }

    function stopTraining() {
      if (trainingActive) {
        trainingActive = false;
        clearTimeout(timer);
        clearInterval(timerInterval);
        alert("Training stopped!");
        document.getElementById("currentPositionName").textContent = "";
        document.getElementById("currentPositionImage").src = "";
        document.getElementById("timer").textContent = ""; // Clear the timer display
      }
    }
    
    function startTraining() {
      if (trainingActive) return; // Don't start if already active
      trainingActive = true;
      const difficulty = parseInt(document.getElementById("difficulty").value);
      const duration = parseInt(document.getElementById("duration").value) * 1000;
      const currentPositionNameElement = document.getElementById("currentPositionName");
      const currentPositionImageElement = document.getElementById("currentPositionImage");
      endTime = Date.now() + duration; // Calculate the end time

      const filteredPositions = positions.filter(pos => pos.difficulty <= difficulty);
      const startTime = Date.now();

      updateTimerDisplay(); // Initial display
      timerInterval = setInterval(updateTimerDisplay, 1000); // Update every second


     function nextPosition() {
        if (!trainingActive) return; // Stop if training is no longer active
        const currentTime = Date.now();
        if (currentTime - startTime >= duration && trainingActive) {
          trainingActive = false;
          clearTimeout(timer);
          clearInterval(timerInterval);
          alert("Training session complete!");
          currentPositionNameElement.textContent = "";
          currentPositionImageElement.src = "";
          return;
        }

        const randomIndex = Math.floor(Math.random() * filteredPositions.length);
        const currentPosition = filteredPositions [randomIndex];

        currentPositionNameElement.textContent = currentPosition.name;
        currentPositionImageElement.src = currentPosition.imageFile;
        playAudio(currentPosition.audioFile);

        // Generate random hold time
        let minHold, maxHold;
        switch (difficulty) {
          case 1: minHold = 10000; maxHold = 15000; break; // At least 10 seconds
          case 2: minHold = 12000; maxHold = 18000; break;
          case 3: minHold = 15000; maxHold = 20000; break;
          default: minHold = 10000; maxHold = 12000;
        }
        const holdTime = Math.random() * (maxHold - minHold) + minHold;

        // Set a timeout to call the nextPosition function after the hold time
        console.log("Hold Time:", holdTime);
        timer = setTimeout(nextPosition, holdTime);
      }

      // Start the training by calling the first nextPosition
      nextPosition();
    }
  </script>


  
</body>
</html>
