<!DOCTYPE html>
<html>
<head>
  <title>Position Training</title>
</head>
<body>
  <div>
    <label for="difficulty">Difficulty:</label>
    <select id="difficulty">
      <option value="1">Easy</option>
      <option value="2">Medium</option>
      <option value="3">Hard</option>
    </select>
  </div>
  <div>
    <label for="duration">Duration (seconds):</label>
    <input type="number" id="duration" value="60">
  </div>
  <button onclick="startTraining()">Start</button>
  <div id="currentPositionName"></div>
  <img id="currentPositionImage" src="" alt="Current Position">
  <script>
    const positions = [
       {
    name: "Nadu",
    audioFile: "audio/Nadu.mp3"
    imageFile: "images/female-nadu.jpg",
    difficulty: 1
  },
  {
    name: "Collar",
    audioFile: "audio/Collar.mp3",
    imageFile: "images/female-collar.jpg",
    difficulty: 1
  },
  {
    name: "Bara",
    audioFile: "audio/Bara.mp3",
    imageFile: "images/female-bara.jpg",
    difficulty: 1
  },
  {
    name: "Expose",
    audioFile: "audio/Expose.mp3",
    imageFile: "images/female-expose.jpg",
    difficulty: 1
  },
  {
    name: "Inspection",
    audioFile: "audio/Inspection.mp3",
    imageFile: "images/female-inspect.jpg",
    difficulty: 1
  }
  {
    name: "Sula",
    audioFile: "audio/Sula.mp3",
    imageFile: "images/female-sula.jpg",
    difficulty: 1
      // Add more positions here!
    ];

    function playAudio(url) {
        // Inside this function, the 'url' parameter will hold the value
        // that was passed from the startTraining function (i.e., currentPosition.audioFile).
     console.log("Attempting to fetch audio from:", url); //
      fetch(url)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
        .then(audioBuffer => {
          const source = audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.connect(audioContext.destination);
          source.start();
        })
        .catch(error => console.error("Error playing audio:", error));
    }

    // Initialize the AudioContext (do this once)
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function startTraining() {
      const difficulty = parseInt(document.getElementById("difficulty").value);
      const duration = parseInt(document.getElementById("duration").value);
      const currentPositionNameElement = document.getElementById("currentPositionName");
      const currentPositionImageElement = document.getElementById("currentPositionImage");

      const filteredPositions = positions.filter(pos => pos.difficulty <= difficulty);
      const startTime = Date.now();
      let intervalId;

      intervalId = setInterval(() => {
        const currentTime = Date.now();
        if (currentTime - startTime >= duration * 1000) {
          clearInterval(intervalId);
          alert("Training session complete!");
          currentPositionNameElement.textContent = "";
          currentPositionImageElement.src = "";
          return;
        }

        const randomIndex = Math.floor(Math.random() * filteredPositions.length);
        const currentPosition = filteredPositions [randomIndex];

        currentPositionNameElement.textContent = currentPosition.name;
        currentPositionImageElement.src = currentPosition.imageFile;
        playAudio(currentPosition.audioFile);

        // Generate random hold time (adjust ranges based on difficulty)
        let minHold, maxHold;
        switch (difficulty) {
          case 1: minHold = 3000; maxHold = 7000; break; // 3-7 seconds
          case 2: minHold = 5000; maxHold = 10000; break; // 5-10 seconds
          case 3: minHold = 8000; maxHold = 15000; break; // 8-15 seconds
          default: minHold = 4000; maxHold = 8000;
        }
        const holdTime = Math.random() * (maxHold - minHold) + minHold;

        // Set a timeout for the next position change
        setTimeout(() => {
          // This will happen after the hold time. For now, the next interval will trigger it.
          // You might want to adjust the interval of the main timer if needed for smoother transitions.
        }, holdTime);

      }, 100); // Initial interval, the next position is triggered within this interval
    }
  </script>
</body>
</html>
