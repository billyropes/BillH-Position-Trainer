<!DOCTYPE html>
<html>
<head>
  <title>Position Training</title>
</head>
<body>
  <div>
    <label for="difficulty">Difficulty:</label>
    <select id="difficulty">
      <option value="1">Easy</option>
      <option value="2">Medium</option>
      <option value="3">Hard</option>
    </select>
  </div>
  <div>
    <label for="duration">Duration (seconds):</label>
    <input type="number" id="duration" value="25">
  </div>
  <button onclick="startTraining()">Start</button>
  <div id="currentPositionName">Ready to Start</div>
  <img id="currentPositionImage" src="images/placeholder.png" alt="Current Position">

  <script>
    const positions = [
       {
    name: "Nadu",
    audioFile: "audio/Nadu.mp3",
    imageFile: "images/female-nadu.jpg",
    difficulty: 1
  },
  {
    name: "Collar",
    audioFile: "audio/Collar.mp3",
    imageFile: "images/female-collar.png",
    difficulty: 1
  },
  {
    name: "Bara",
    audioFile: "audio/Bara.mp3",
    imageFile: "images/female-bara.jpg",
    difficulty: 1
  },
  {
    name: "Expose",
    audioFile: "audio/Expose.mp3",
    imageFile: "images/female-expose.jfif",
    difficulty: 1
  },
  {
    name: "Inspection",
    audioFile: "audio/Inspection.mp3",
    imageFile: "images/female-inspect.jpg",
    difficulty: 1
  },
  {
    name: "Sula",
    audioFile: "audio/Sula.mp3",
    imageFile: "images/female-sula.png",
    difficulty: 1
  },
  ];

    function playAudio(url) {
        // Inside this function, the 'url' parameter will hold the value
        // that was passed from the startTraining function (i.e., currentPosition.audioFile).
     console.log("Attempting to fetch audio from:", url); //
      fetch(url)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
        .then(audioBuffer => {
          const source = audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.connect(audioContext.destination);
          source.start();
        })
        .catch(error => console.error("Error playing audio:", error));
    }

    // Initialize the AudioContext (do this once)
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

function startTraining() {
      const difficulty = parseInt(document.getElementById("difficulty").value);
      const duration = parseInt(document.getElementById("duration").value) * 1000; // Convert to milliseconds
      const currentPositionNameElement = document.getElementById("currentPositionName");
      const currentPositionImageElement = document.getElementById("currentPositionImage");

      const filteredPositions = positions.filter(pos => pos.difficulty <= difficulty);
      const startTime = Date.now();
      let timer; // To hold the timeout ID

      function nextPosition() {
        const currentTime = Date.now();
        if (currentTime - startTime >= duration) {
          clearTimeout(timer);
          alert("Training session complete!");
          currentPositionNameElement.textContent = "";
          currentPositionImageElement.src = "";
          return;
        }

        const randomIndex = Math.floor(Math.random() * filteredPositions.length);
        const currentPosition = filteredPositions [randomIndex];

        currentPositionNameElement.textContent = currentPosition.name;
        currentPositionImageElement.src = currentPosition.imageFile;
        playAudio(currentPosition.audioFile);

        // Generate random hold time
        let minHold, maxHold;
        switch (difficulty) {
          case 1: minHold = 10000; maxHold = 15000; break; // At least 10 seconds
          case 2: minHold = 12000; maxHold = 18000; break;
          case 3: minHold = 15000; maxHold = 20000; break;
          default: minHold = 10000; maxHold = 12000;
        }
        const holdTime = Math.random() * (maxHold - minHold) + minHold;

        // Set a timeout to call the nextPosition function after the hold time
        console.log("Hold Time:", holdTime);
        timer = setTimeout(nextPosition, holdTime);
      }

      // Start the training by calling the first nextPosition
      nextPosition();
    }
  </script>

    <button onclick="startTraining()">Start</button>
  <div id="currentPositionName">Ready to Start</div>
  <img id="currentPositionImage" src="images/placeholder.png" alt="Current Position">
  
</body>
</html>
